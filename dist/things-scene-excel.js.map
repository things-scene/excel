{"version":3,"file":"things-scene-excel.js","sources":["../src/excel.png","../src/excel.js","../src/index.js"],"sourcesContent":["export default \"data:image/png;base64,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\"","/*\n * Copyright © HatioLab Inc. All rights reserved.\n */\n\nimport COMPONENT_IMAGE from \"./excel.png\";\n\nimport { Component, DataSource, RectPath, Shape } from \"@hatiolab/things-scene\";\nimport XLSX from \"xlsx\";\n\nconst NATURE = {\n  mutable: false,\n  resizable: true,\n  rotatable: true,\n  properties: [\n    {\n      type: \"string\",\n      label: \"src\",\n      name: \"src\",\n      placeholder: \"Excel File URL\"\n    }\n  ]\n};\n\nasync function fetchData(url) {\n  const file = await fetch(url, {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/xlsx\"\n    },\n    credentials: \"include\"\n  });\n\n  const workbook = XLSX.read(await file.arrayBuffer(), { type: \"array\" });\n\n  var result = {};\n  workbook.SheetNames.forEach(sheet => {\n    var roa = XLSX.utils.sheet_to_json(workbook.Sheets[sheet]);\n    if (roa.length) {\n      result[sheet] = roa;\n    }\n  });\n\n  console.log(\"result\", result);\n  return result;\n}\n\nexport default class Excel extends DataSource(RectPath(Shape)) {\n  static get image() {\n    if (!Excel._image) {\n      Excel._image = new Image();\n      Excel._image.src = COMPONENT_IMAGE;\n    }\n\n    return Excel._image;\n  }\n\n  dispose() {\n    super.dispose();\n  }\n\n  ready() {\n    const { src } = this.state;\n\n    if (src) {\n      fetchData(src).then(data => {\n        this.setState(\"data\", data);\n      });\n    }\n  }\n\n  render(context) {\n    /*\n     * TODO role이 publisher 인지 subscriber 인지에 따라서 구분할 수 있는 표시를 추가할 것.\n     */\n\n    var { left, top, width, height } = this.bounds;\n\n    context.beginPath();\n    context.drawImage(Excel.image, left, top, width, height);\n  }\n\n  get nature() {\n    return NATURE;\n  }\n\n  get src() {\n    return this._src;\n  }\n\n  set src(src) {\n    this._src = src;\n\n    if (src) {\n      fetchData(src).then(data => {\n        this.setState(\"data\", data);\n      });\n    }\n  }\n\n  ondropfile(transfered, files) {\n    for (let i = 0; i < transfered.length; i++) {\n      if (/\\.xlsx?$/.test(transfered[i].name)) {\n        this.src = files[i];\n        return;\n      }\n    }\n  }\n}\n\nComponent.register(\"excel\", Excel);\n","import Excel from \"./excel\";\nexport default [Excel];"],"names":["NATURE","mutable","resizable","rotatable","properties","type","label","name","placeholder","async","fetchData","url","file","fetch","method","headers","credentials","workbook","XLSX","read","arrayBuffer","result","SheetNames","forEach","sheet","roa","utils","sheet_to_json","Sheets","length","console","log","Excel","DataSource","RectPath","Shape","_image","Image","src","COMPONENT_IMAGE","dispose","ready","this","state","then","data","setState","render","context","left","top","width","height","bounds","beginPath","drawImage","image","_src","ondropfile","transfered","files","i","test","register"],"mappings":"kWAAe,y0FCSf,MAAMA,EAAS,CACbC,SAAS,EACTC,WAAW,EACXC,WAAW,EACXC,WAAY,CACV,CACEC,KAAM,SACNC,MAAO,MACPC,KAAM,MACNC,YAAa,oBAKnBC,eAAeC,EAAUC,SACjBC,QAAaC,MAAMF,EAAK,CAC5BG,OAAQ,MACRC,QAAS,gBACS,oBAElBC,YAAa,YAGTC,EAAWC,EAAKC,WAAWP,EAAKQ,cAAe,CAAEf,KAAM,cAEzDgB,EAAS,UACbJ,EAASK,WAAWC,QAAQC,QACtBC,EAAMP,EAAKQ,MAAMC,cAAcV,EAASW,OAAOJ,IAC/CC,EAAII,SACNR,EAAOG,GAASC,KAIpBK,QAAQC,IAAI,SAAUV,GACfA,EAGM,MAAMW,UAAcC,aAAWC,WAASC,qCAE9CH,EAAMI,SACTJ,EAAMI,OAAS,IAAIC,MACnBL,EAAMI,OAAOE,IAAMC,GAGdP,EAAMI,OAGfI,gBACQA,UAGRC,cACQH,IAAEA,GAAQI,KAAKC,MAEjBL,GACF5B,EAAU4B,GAAKM,KAAKC,SACbC,SAAS,OAAQD,KAK5BE,OAAOC,OAKDC,KAAEA,EAAFC,IAAQA,EAARC,MAAaA,EAAbC,OAAoBA,GAAWV,KAAKW,OAExCL,EAAQM,YACRN,EAAQO,UAAUvB,EAAMwB,MAAOP,EAAMC,EAAKC,EAAOC,uBAI1CpD,mBAIA0C,KAAKe,aAGNnB,QACDmB,KAAOnB,EAERA,GACF5B,EAAU4B,GAAKM,KAAKC,SACbC,SAAS,OAAQD,KAK5Ba,WAAWC,EAAYC,OAChB,IAAIC,EAAI,EAAGA,EAAIF,EAAW9B,OAAQgC,OACjC,WAAWC,KAAKH,EAAWE,GAAGtD,uBAC3B+B,IAAMsB,EAAMC,wBAOfE,SAAS,QAAS/B,GC5Gb,CAACA"}